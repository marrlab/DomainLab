# test benchmark config.

test_domains:
  - sketch

output_dir: zoutput/benchmarks/pacs_benchmark
# number of hyperparameter samples per task.
# Thus, the total runs of each task are given
# by len(domains) * num_param_samples * num_seeds (see below)
num_param_samples: 8
sampling_seed: 0

startseed: 0
endseed: 5  # currently included



domainlab_args:
  # Domainlab arguments passed to each task.
  # task specific arguments take precedence.
  ## dataset
  tpath: examples/tasks/task_pacs_path_list.py
  npath: examples/nets/resnet50domainbed.py
  npath_dom: examples/nets/resnet50domainbed.py
  npath_topic_distrib_img2topic: examples/nets/resnet50domainbed.py
  npath_encoder_sandwich_layer_img2h4zd: examples/nets/resnet50domainbed.py
  dmem: False
  lr: 5e-5
  epos: 500
  es: 1
  bs: 32
  san_check: True


Shared params:
  gamma_y:
    min: 1e4
    max: 2e5
    step: 100
    distribution: loguniform

  zy_dim:
    min: 32
    max: 96
    step: 32
    distribution: uniform

  zd_dim:
    reference: zy_dim

  # penalty weight for matching loss (Lambda in paper)
  gamma_reg:
    min: 0.01
    max: 10
    distribution: loguniform

  gamma_d:
    min: 1e4
    max: 1e6
    step: 10_000
    distribution: loguniform


erm:  # name
  aname: deepall


hduva_matchdg:  # name
  aname: matchhduva
  shared:
    - gamma_y
    - zx_dim
    - zy_dim
    - zd_dim
    - gamma_reg

  hyperparameters:

    # Total number of epochs for contrastive loss
    epochs_ctr:
      min: 2
      max: 10
      step: 1
      distribution: uniform

    # factor to magnify cosine similarity
    tau:
      min: 0.01
      max: 1
      distribution: loguniform

    # Number of epochs before updating the match tensor
    epos_per_match_update:
      min: 1
      max: 20
      step: 1
      distribution: uniform


hduva_dial:
  # Parameters that are fixed for all runs of this task.
  aname: hduva
  trainer: dial
  npath: examples/nets/resnet50domainbed.py
  nname_topic_distrib_img2topic: examples/nets/resnet50domainbed.py
  nname_encoder_sandwich_layer_img2h4zd: examples/nets/resnet50domainbed.py
  # specification of parameters that shall vary
  # between runs to analyze the sensitivity
  # of this task w.r.t. these parameters.

  shared:
    - gamma_y
    - zx_dim
    - zd_dim
    - zy_dim
    - gamma_reg
    - gamma_d

  hyperparameters:
    # Each parameter must contain:
    # - distribution (uniform | loguniform | normal | lognormal)
    # - min and max if distribution is uniform or loguniform
    # - mean and std if distribution is normal or lognormal

    # step is optional and defines discrete parameters
    # with the given step size.
    # If min/mean and step are integer valued,
    # the hyperparameter is ensured to be integer valued too.
    # Otherwise, it is a float and rounding errors can occur.

    dial_steps_perturb:
      min: 1
      max: 10
      step: 1
      distribution: uniform

    dial_noise_scale:
      min: 0.00001
      max: 0.1
      distribution: loguniform

    dial_epsilon:
      min: 0.001
      max: 0.01
      distribution: loguniform



diva_dial:
  # Parameters that are fixed for all runs of this task.
  aname: diva
  trainer: dial
  # specification of parameters that shall vary
  # between runs to analyze the sensitivity
  # of this task w.r.t. these parameters.
  shared:
    - gamma_y
    - zx_dim
    - zy_dim
    - zd_dim
    - gamma_d
    - gamma_reg

  hyperparameters:
    # Each parameter must contain:
    # - distribution (uniform | loguniform | normal | lognormal)
    # - min and max if distribution is uniform or loguniform
    # - mean and std if distribution is normal or lognormal

    # step is optional and defines discrete parameters
    # with the given step size.
    # If min/mean and step are integer valued,
    # the hyperparameter is ensured to be integer valued too.
    # Otherwise, it is a float and rounding errors can occur.

    dial_steps_perturb:
      min: 1
      max: 10
      step: 1
      distribution: uniform

    dial_noise_scale:
      min: 0.00001
      max: 0.1
      distribution: loguniform

    dial_epsilon:
      min: 0.001
      max: 0.01
      distribution: loguniform


# Each node containing the aname property is considered as a task.
diva_mldg:  # name
  # Parameters that are fixed for all runs of this task.
  aname: diva
  trainer: mldg
  shared:
    - gamma_y
    - gamma_d


hduva_mldg:  # name
  aname: hduva
  trainer: mldg
  shared:
    - gamma_y
    - zy_dim
